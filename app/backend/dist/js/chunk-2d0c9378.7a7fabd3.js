(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c9378"],{"57cc":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"backend-content",attrs:{id:"content"}},[s("div",{staticClass:"column col-8 col-xs-12"},[s("h3",{staticClass:"s-title"},[t._v("Gérer les instances MISP")]),s("ul",{staticClass:"tab tab-block"},[s("li",{staticClass:"tab-item"},[s("a",{class:{active:t.tabs.addmisp},attrs:{href:"#"},on:{click:function(s){return t.switch_tab("addmisp")}}},[t._v("Ajouter une instance")])]),s("li",{staticClass:"tab-item"},[s("a",{class:{active:t.tabs.instances},attrs:{href:"#"},on:{click:function(s){return t.switch_tab("instances")}}},[t._v("Instances déjà existantes")])])]),t.tabs.addmisp?s("div",[s("div",{staticClass:"misp-form"},[s("label",{staticClass:"misp-label"},[t._v("Nom de l'instance")]),s("span"),s("input",{directives:[{name:"model",rawName:"v-model",value:t.mispinst.name,expression:"mispinst.name"}],ref:"misp_name",staticClass:"form-input",attrs:{type:"text",placeholder:"CYBERACME MISP",required:""},domProps:{value:t.mispinst.name},on:{input:function(s){s.target.composing||t.$set(t.mispinst,"name",s.target.value)}}}),s("label",{staticClass:"misp-label"},[t._v("URL de l'instance")]),s("span"),s("input",{directives:[{name:"model",rawName:"v-model",value:t.mispinst.url,expression:"mispinst.url"}],ref:"misp_url",staticClass:"form-input",attrs:{type:"text",placeholder:"https://misp.cyberacme.com",required:""},domProps:{value:t.mispinst.url},on:{input:function(s){s.target.composing||t.$set(t.mispinst,"url",s.target.value)}}}),s("label",{staticClass:"misp-label"},[t._v("Clé d'authentification")]),s("span"),s("input",{directives:[{name:"model",rawName:"v-model",value:t.mispinst.key,expression:"mispinst.key"}],ref:"misp_key",staticClass:"form-input",attrs:{type:"text",placeholder:"OqHSMyAuth3ntic4t10nK3y0MyAuth3ntic4t10nK3y3iiH",required:""},domProps:{value:t.mispinst.key},on:{input:function(s){s.target.composing||t.$set(t.mispinst,"key",s.target.value)}}}),t.mispinst.url.startsWith("https://")?s("label",{staticClass:"misp-label"},[t._v("Verifier le certificat? ")]):t._e(),t.mispinst.url.startsWith("https://")?s("span"):t._e(),t.mispinst.url.startsWith("https://")?s("div",{staticStyle:{flex:"50%"}},[s("label",{staticClass:"form-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.mispinst.ssl,expression:"mispinst.ssl"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.mispinst.ssl)?t._i(t.mispinst.ssl,null)>-1:t.mispinst.ssl},on:{change:function(s){var e=t.mispinst.ssl,i=s.target,a=!!i.checked;if(Array.isArray(e)){var n=null,c=t._i(e,n);i.checked?c<0&&t.$set(t.mispinst,"ssl",e.concat([n])):c>-1&&t.$set(t.mispinst,"ssl",e.slice(0,c).concat(e.slice(c+1)))}else t.$set(t.mispinst,"ssl",a)}}}),s("i",{staticClass:"form-icon"})])]):t._e()]),s("button",{staticClass:"btn-primary btn col-12",on:{click:function(s){return t.add_instance()}}},[t._v("Ajouter l'instance MISP")]),t.added?s("div",{staticClass:"form-group"},[s("div",{staticClass:"toast toast-success"},[t._v(" ✓ instance MISP ajoutée avec succès. Redirection vers l'instance dans 2 secondes. ")])]):t._e(),t.error?s("div",{staticClass:"form-group"},[s("div",{staticClass:"toast toast-error"},[t._v(" ✗ instance MISP pas ajoutée. "+t._s(t.error)+" ")])]):t._e()]):t._e(),t.tabs.instances?s("div",{staticClass:"form-group"},[t.instances.length?s("div",[s("table",{staticClass:"table table-striped table-hover"},[t._m(0),s("tbody",t._l(t.instances,(function(e){return s("tr",{key:e.id},[s("td",[t._v(t._s(e.name))]),s("td",[t._v(t._s(e.url.replace("https://","").replace("http://","")))]),s("td",[t._v(t._s(e.apikey.slice(0,5))+" [...] "+t._s(e.apikey.slice(35,40)))]),s("td",[e.connected?s("span",{staticClass:"instance-online tooltip",attrs:{"data-tooltip":e.lastsync}},[t._v("✓ EN LIGNE")]):s("span",{staticClass:"instance-offline tooltip",attrs:{"data-tooltip":e.lastsync}},[t._v("⚠ HORS LIGNE")])]),s("td",[s("button",{staticClass:"btn btn-sm",on:{click:function(s){return t.delete_instance(e)}}},[t._v("Suprrimer")])])])})),0)])]):s("div",[s("div",{staticClass:"empty"},[t.loading?s("div",[t._m(1),s("p",{staticClass:"empty-subtitle"},[t._v("Test et chargement de votre instance MISP.")])]):s("div",[s("p",{staticClass:"empty-title h5"},[t._v("Aucune instance MISP trouvée.")]),s("p",{staticClass:"empty-subtitle"},[t._v("N'hésitez pas à ajouter une instance MISP.")])])])])]):t._e()])])},a=[function(){var t=this,s=t._self._c;return s("thead",[s("tr",[s("th",[t._v("Nom")]),s("th",[t._v("Serveur")]),s("th",[t._v("Authkey")]),s("th",[t._v("Status")]),s("th",[t._v("Action")])])])},function(){var t=this,s=t._self._c;return s("p",{staticClass:"empty-title h5"},[s("span",{staticClass:"loading loading-lg"})])}],n=e("bc3a"),c=e.n(n),l={name:"managemisp",data(){return{error:!1,loading:!1,added:!1,mispinst:{name:"",url:"",key:"",ssl:!1},instances:[],tabs:{addmisp:!0,instances:!1},jwt:""}},props:{},methods:{add_instance:function(){this.added=!1,this.error=!1,this.mispinst.name&&this.mispinst.url&&this.mispinst.key&&c.a.post("/api/misp/add",{data:{instance:this.mispinst}},{headers:{"X-Token":this.jwt}}).then(t=>{t.data.status?(this.added=!0,setTimeout(function(){this.switch_tab("instances"),this.mispinst={name:"",url:"",key:"",ssl:!1},this.added=!1}.bind(this),2e3)):this.error=t.data.message}).catch(t=>console.log(t))},delete_instance(t){c.a.get("/api/misp/delete/"+t.id,{timeout:1e4,headers:{"X-Token":this.jwt}}).then(s=>{s.data.status&&(this.instances=this.instances.filter((function(s){return s!=t})))}).catch(t=>console.log(t))},get_misp_instances(){this.loading=!0,this.instances=[],c.a.get("/api/misp/get_all",{timeout:1e4,headers:{"X-Token":this.jwt}}).then(t=>{t.data.results&&(this.instances=t.data.results,this.instances.forEach(t=>{var s=parseInt((Date.now()/1e3-t.lastsync)/86400);t.lastsync=s?`Synchronized ${s} day(s) ago`:"Synchronized today"})),this.loading=!1}).catch(t=>console.log(t))},switch_tab:function(t){Object.keys(this.tabs).forEach(s=>{s==t?(this.tabs[s]=!0,"instances"==s&&this.get_misp_instances()):this.tabs[s]=!1})},get_jwt(){c.a.get("/api/get-token",{timeout:1e4}).then(t=>{t.data.token&&(this.jwt=t.data.token)}).catch(t=>console.log(t))}},created:function(){this.get_jwt()}},r=l,o=e("2877"),p=Object(o["a"])(r,i,a,!1,null,null,null);s["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d0c9378.7a7fabd3.js.map